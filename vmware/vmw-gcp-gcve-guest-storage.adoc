---
sidebar: sidebar 
permalink: vmware/vmw-gcp-gcve-guest-storage.html 
keywords: NetApp Solutions, google cloud, gcp, gcve, enterprise, hybrid, cloud, cloud volumes ontap, cvo 
summary:  
---
= 适用于 GCP 的NetApp存储选项
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
GCP 支持通过Cloud Volumes ONTAP (CVO) 或Google Cloud NetApp Volumes (NetApp Volumes) 连接来宾的NetApp存储。



== Cloud Volumes ONTAP (CVO)

Cloud Volumes ONTAP（或称 CVO）是基于 NetApp 的ONTAP存储软件构建的业界领先的云数据管理解决方案，可在 Amazon Web Services (AWS)、Microsoft Azure 和 Google Cloud Platform (GCP) 上原生使用。

它是ONTAP的软件定义版本，使用云原生存储，允许您在云端和本地使用相同的存储软件，从而无需重新培训 IT 人员采用全新方法来管理数据。

CVO 使客户能够无缝地将数据从边缘移动到数据中心、云端并返回，从而将您的混合云整合在一起 - 所有这些都通过单一窗格管理控制台NetApp Cloud Manager 进行管理。

CVO 的设计旨在提供极致的性能和先进的数据管理功能，以满足您在云端最苛刻的应用程序



=== Cloud Volumes ONTAP (CVO) 作为来宾连接存储

.在 Google Cloud 中部署Cloud Volumes ONTAP （自行部署）
[%collapsible%open]
====
可以从在 GCVE 私有云环境中创建的虚拟机挂载Cloud Volumes ONTAP共享和 LUN。这些卷还可以安装在 Linux 客户端和 Windows 客户端上，并且当通过 iSCSI 安装时，可以在 Linux 或 Windows 客户端上将 LUNS 作为块设备进行访问，因为Cloud Volumes ONTAP支持 iSCSI、SMB 和 NFS 协议。只需几个简单的步骤即可设置Cloud Volumes ONTAP卷。

要将卷从本地环境复制到云端以用于灾难恢复或迁移，请使用站点到站点 VPN 或 Cloud Interconnect 建立与 Google Cloud 的网络连接。将数据从本地复制到Cloud Volumes ONTAP超出了本文档的范围。要在本地和Cloud Volumes ONTAP系统之间复制数据，请参阅link:mailto:CloudOwner@gve.local#setting-up-data-replication-between-systems["设置系统之间的数据复制"]。


NOTE: 使用link:https://cloud.netapp.com/cvo-sizer["Cloud Volumes ONTAP大小调整器"]准确确定Cloud Volumes ONTAP实例的大小。还可以监控本地性能以用作Cloud Volumes ONTAP大小调整器的输入。

. 登录NetApp Cloud Central — 显示 Fabric View 屏幕。找到Cloud Volumes ONTAP选项卡并选择转到云管理器。登录后，将显示 Canvas 屏幕。
+
image:gcve-cvo-guest-001.png["该图显示输入/输出对话框或表示书面内容"]

. 在 Cloud Manager Canvas 选项卡上，单击添加工作环境，然后选择 Google Cloud Platform 作为云和系统配置类型。然后单击“下一步”。
+
image:gcve-cvo-guest-002.png["该图显示输入/输出对话框或表示书面内容"]

. 提供要创建的环境的详细信息，包括环境名称和管理员凭据。完成后，单击“继续”。
+
image:gcve-cvo-guest-003.png["该图显示输入/输出对话框或表示书面内容"]

. 选择或取消选择Cloud Volumes ONTAP部署的附加服务，包括数据感知与合规性或备份到云。然后，单击“继续”。
+
提示：停用附加服务时将显示验证弹出消息。  CVO 部署后可以添加/删除附加服务，如果从一开始就不需要，请考虑取消选择它们以避免成本。

+
image:gcve-cvo-guest-004.png["该图显示输入/输出对话框或表示书面内容"]

. 选择一个位置，选择防火墙策略，然后选中复选框以确认与 Google Cloud 存储的网络连接。
+
image:gcve-cvo-guest-005.png["该图显示输入/输出对话框或表示书面内容"]

. 选择许可证选项：按使用量付费或使用现有许可证的 BYOL。在此示例中，使用了免费增值选项。然后，点击继续。
+
image:gcve-cvo-guest-006.png["该图显示输入/输出对话框或表示书面内容"]

. 根据将在 AWS SDDC 上的 VMware 云上运行的虚拟机上部署的工作负载类型，在几个可用的预配置包中进行选择。
+
提示：将鼠标悬停在图块上以查看详细信息，或单击“更改配置”自定义 CVO 组件和ONTAP版本。

+
image:gcve-cvo-guest-007.png["该图显示输入/输出对话框或表示书面内容"]

. 在“审核并批准”页面上，审核并确认选择。要创建Cloud Volumes ONTAP实例，请单击“开始”。
+
image:gcve-cvo-guest-008.png["该图显示输入/输出对话框或表示书面内容"]

. 配置Cloud Volumes ONTAP后，它会列在 Canvas 页面上的工作环境中。
+
image:gcve-cvo-guest-009.png["该图显示输入/输出对话框或表示书面内容"]



====
.SMB 卷的附加配置
[%collapsible%open]
====
. 工作环境准备好后，请确保 CIFS 服务器配置了适当的 DNS 和 Active Directory 配置参数。在创建 SMB 卷之前，需要执行此步骤。
+
提示：单击菜单图标 (º)，选择高级以显示更多选项并选择 CIFS 设置。

+
image:gcve-cvo-guest-010.png["该图显示输入/输出对话框或表示书面内容"]

. 创建 SMB 卷是一个简单的过程。在 Canvas 中，双击Cloud Volumes ONTAP工作环境来创建和管理卷，然后单击创建卷选项。选择适当的大小，云管理器选择包含的聚合或使用高级分配机制放置在特定的聚合上。对于此演示，选择 CIFS/SMB 作为协议。
+
image:gcve-cvo-guest-011.png["该图显示输入/输出对话框或表示书面内容"]

. 卷配置完成后，它将在“卷”窗格下可用。由于已配置 CIFS 共享，请授予您的用户或组对文件和文件夹的权限，并验证这些用户是否可以访问共享并创建文件。如果从本地环境复制卷，则不需要此步骤，因为文件和文件夹权限都将作为SnapMirror复制的一部分保留。
+
提示：单击音量菜单 (º) 以显示其选项。

+
image:gcve-cvo-guest-012.png["该图显示输入/输出对话框或表示书面内容"]

. 创建卷后，使用 mount 命令显示卷连接说明，然后从 Google Cloud VMware Engine 上的虚拟机连接到共享。
+
image:gcve-cvo-guest-013.png["该图显示输入/输出对话框或表示书面内容"]

. 复制以下路径并使用映射网络驱动器选项将卷挂载到在 Google Cloud VMware Engine 上运行的虚拟机上。
+
image:gcve-cvo-guest-014.png["该图显示输入/输出对话框或表示书面内容"]

+
一旦映射，就可以轻松访问，并且可以相应地设置 NTFS 权限。

+
image:gcve-cvo-guest-015.png["该图显示输入/输出对话框或表示书面内容"]



====
.Cloud Volumes ONTAP上的 LUN 连接到主机
[%collapsible%open]
====
要将云卷ONTAP LUN 连接到主机，请完成以下步骤：

. 在“画布”页面上，双击Cloud Volumes ONTAP工作环境以创建和管理卷。
. 单击添加卷 > 新卷并选择 iSCSI，然后单击创建启动器组。单击“Continue”。
+
image:gcve-cvo-guest-016.png["该图显示输入/输出对话框或表示书面内容"] image:gcve-cvo-guest-017.png["该图显示输入/输出对话框或表示书面内容"]

. 配置卷后，选择卷菜单 (º)，然后单击目标 iQN。要复制 iSCSI 限定名称 (iQN)，请单击复制。建立从主机到 LUN 的 iSCSI 连接。


要对驻留在 Google Cloud VMware Engine 上的主机完成相同操作：

. 通过 RDP 连接到托管在 Google Cloud VMware Engine 上的虚拟机。
. 打开 iSCSI 发起程序属性对话框：服务器管理器 > 仪表板 > 工具 > iSCSI 发起程序。
. 在“发现”选项卡中，单击“发现门户”或“添加门户”，然后输入 iSCSI 目标端口的 IP 地址。
. 从“目标”选项卡中，选择发现的目标，然后单击“登录”或“连接”。
. 选择启用多路径，然后选择计算机启动时自动恢复此连接或将此连接添加到收藏目标列表。单击“高级”。
+

NOTE: Windows 主机必须与群集中的每个节点建立 iSCSI 连接。本机 DSM 选择最佳路径以供使用。

+
image:gcve-cvo-guest-018.png["该图显示输入/输出对话框或表示书面内容"]

+
存储虚拟机 (SVM) 上的 LUN 对于 Windows 主机来说显示为磁盘。主机不会自动发现任何新添加的磁盘。通过完成以下步骤触发手动重新扫描以发现磁盘：

+
.. 打开 Windows 计算机管理实用程序：开始 > 管理工具 > 计算机管理。
.. 在导航树中展开存储节点。
.. 单击“磁盘管理”。
.. 单击操作 > 重新扫描磁盘。
+
image:gcve-cvo-guest-019.png["该图显示输入/输出对话框或表示书面内容"]

+
当 Windows 主机首次访问新的 LUN 时，它没有分区或文件系统。初始化 LUN；并且（可选）通过完成以下步骤使用文件系统格式化 LUN：

.. 启动 Windows 磁盘管理。
.. 右键单击 LUN，然后选择所需的磁盘或分区类型。
.. 按照向导中的说明进行操作。在此示例中，已安装驱动器 F:。




image:gcve-cvo-guest-020.png["该图显示输入/输出对话框或表示书面内容"]

在 Linux 客户端上，确保 iSCSI 守护程序正在运行。配置 LUN 后，请参阅此处以 Ubuntu 为例的 iSCSI 配置详细指南。要验证，请从 shell 运行 lsblk cmd。

image:gcve-cvo-guest-021.png["该图显示输入/输出对话框或表示书面内容"] image:gcve-cvo-guest-022.png["该图显示输入/输出对话框或表示书面内容"]

====
.在 Linux 客户端上挂载Cloud Volumes ONTAP NFS 卷
[%collapsible%open]
====
要从 Google Cloud VMware Engine 中的虚拟机挂载Cloud Volumes ONTAP (DIY) 文件系统，请按照以下步骤操作：

按照以下步骤配置卷

. 在卷选项卡中，单击创建新卷。
. 在“创建新卷”页面上，选择卷类型：
+
image:gcve-cvo-guest-023.png["该图显示输入/输出对话框或表示书面内容"]

. 在“卷”选项卡中，将鼠标光标放在卷上，选择菜单图标 (º)，然后单击“挂载命令”。
+
image:gcve-cvo-guest-024.png["该图显示输入/输出对话框或表示书面内容"]

. 单击“复制”。
. 连接到指定的Linux实例。
. 使用安全外壳 (SSH) 在实例上打开终端并使用适当的凭据登录。
. 使用以下命令为卷的挂载点创建一个目录。
+
 $ sudo mkdir /cvogcvetst
+
image:gcve-cvo-guest-025.png["该图显示输入/输出对话框或表示书面内容"]

. 将Cloud Volumes ONTAP NFS 卷挂载到上一步创建的目录。
+
 sudo mount 10.0.6.251:/cvogcvenfsvol01 /cvogcvetst
+
image:gcve-cvo-guest-026.png["该图显示输入/输出对话框或表示书面内容"] image:gcve-cvo-guest-027.png["该图显示输入/输出对话框或表示书面内容"]



====


== Google Cloud NetApp Volumes(NetApp卷)

Google Cloud NetApp Volumes （NetApp Volumes）是一套完整的数据服务组合，可提供先进的云解决方案。  NetApp Volumes 支持主要云提供商的多种文件访问协议（NFS 和 SMB 支持）。

其他优势和功能包括：使用快照进行数据保护和恢复；在本地或云端复制、同步和迁移数据目的地的特殊功能；以及在专用闪存系统级别保持一致的高性能。



=== Google Cloud NetApp Volumes （NetApp Volumes）作为来宾连接存储

.使用 VMware Engine 配置NetApp卷
[%collapsible%open]
====
可以从在 VMware Engine 环境中创建的虚拟机挂载Google Cloud NetApp Volumes共享。由于Google Cloud NetApp Volumes支持 SMB 和 NFS 协议，因此这些卷也可以安装在 Linux 客户端上并映射到 Windows 客户端上。可以通过简单的步骤来设置Google Cloud NetApp Volumes卷。

Google Cloud NetApp Volumes和 Google Cloud VMware Engine 私有云必须位于同一区域。

要从 Google Cloud Marketplace 购买、启用和配置适用于 Google Cloud 的 Google Google Cloud NetApp Volumes ，请按照以下详细说明操作link:https://cloud.google.com/vmware-engine/docs/quickstart-prerequisites["指导"]。

====
.创建NetApp Volumes NFS 卷到 GCVE 私有云
[%collapsible%open]
====
要创建和挂载 NFS 卷，请完成以下步骤：

. 从 Google 云控制台中的合作伙伴解决方案访问 Cloud Volumes。
+
image:gcve-cvs-guest-001.png["该图显示输入/输出对话框或表示书面内容"]

. 在 Cloud Volumes 控制台中，转到卷页面并单击创建。
+
image:gcve-cvs-guest-002.png["该图显示输入/输出对话框或表示书面内容"]

. 在创建文件系统页面上，根据退款机制的需要指定卷名称和计费标签。
+
image:gcve-cvs-guest-003.png["该图显示输入/输出对话框或表示书面内容"]

. 选择适当的服务。对于 GCVE，根据应用程序工作负载要求选择NetApp Volumes-Performance 和所需的服务级别，以改善延迟并提高性能。
+
image:gcve-cvs-guest-004.png["该图显示输入/输出对话框或表示书面内容"]

. 指定卷和卷路径的 Google Cloud 区域（卷路径在项目的所有云卷中必须是唯一的）
+
image:gcve-cvs-guest-005.png["该图显示输入/输出对话框或表示书面内容"]

. 选择卷的性能级别。
+
image:gcve-cvs-guest-006.png["该图显示输入/输出对话框或表示书面内容"]

. 指定卷的大小和协议类型。本次测试采用的是NFSv3。
+
image:gcve-cvs-guest-007.png["该图显示输入/输出对话框或表示书面内容"]

. 在此步骤中，选择可访问卷的 VPC 网络。确保 VPC 对等连接已到位。
+
提示：如果尚未完成 VPC 对等连接，则会显示一个弹出按钮来指导您完成对等连接命令。打开 Cloud Shell 会话并执行适当的命令以将您的 VPC 与Google Cloud NetApp Volumes生产者对等连接。如果您决定提前准备 VPC 对等连接，请参阅这些说明。

+
image:gcve-cvs-guest-008.png["该图显示输入/输出对话框或表示书面内容"]

. 通过添加适当的规则来管理导出策略规则并选中相应 NFS 版本的复选框。
+
注意：除非添加导出策略，否则无法访问 NFS 卷。

+
image:gcve-cvs-guest-009.png["该图显示输入/输出对话框或表示书面内容"]

. 单击“保存”以创建卷。
+
image:gcve-cvs-guest-010.png["该图显示输入/输出对话框或表示书面内容"]



====
.将 NFS 导出挂载到在 VMware Engine 上运行的虚拟机
[%collapsible%open]
====
在准备挂载 NFS 卷之前，请确保私有连接的对等状态列为“活动”。一旦状态为“活动”，请使用 mount 命令。

要挂载 NFS 卷，请执行以下操作：

. 在 Cloud Console 中，转到 Cloud Volumes > Volumes。
. 转到卷页面
. 单击要挂载 NFS 导出的 NFS 卷。
. 滚动到右侧，在“显示更多”下单击“安装说明”。


要从 VMware VM 的客户操作系统中执行安装过程，请按照以下步骤操作：

. 使用 SSH 客户端和 SSH 连接到虚拟机。
. 在实例上安装 nfs 客户端。
+
.. 在 Red Hat Enterprise Linux 或 SuSE Linux 实例上：
+
 sudo yum install -y nfs-utils
.. 在 Ubuntu 或 Debian 实例上：
+
 sudo apt-get install nfs-common


. 在实例上创建一个新目录，例如“/nimCVSNFSol01”：
+
 sudo mkdir /nimCVSNFSol01
+
image:gcve-cvs-guest-020.png["该图显示输入/输出对话框或表示书面内容"]

. 使用适当的命令挂载卷。实验室的示例命令如下：
+
 sudo mount -t nfs -o rw,hard,rsize=65536,wsize=65536,vers=3,tcp 10.53.0.4:/nimCVSNFSol01 /nimCVSNFSol01
+
image:gcve-cvs-guest-021.png["该图显示输入/输出对话框或表示书面内容"] image:gcve-cvs-guest-022.png["该图显示输入/输出对话框或表示书面内容"]



====
.创建 SMB 共享并将其挂载到在 VMware Engine 上运行的虚拟机
[%collapsible%open]
====
对于 SMB 卷，请确保在创建 SMB 卷之前配置了 Active Directory 连接。

image:gcve-cvs-guest-030.png["该图显示输入/输出对话框或表示书面内容"]

一旦 AD 连接到位，即可创建具有所需服务级别的卷。除了选择适当的协议外，步骤与创建 NFS 卷类似。

. 在 Cloud Volumes 控制台中，转到卷页面并单击创建。
. 在创建文件系统页面上，根据退款机制的需要指定卷名称和计费标签。
+
image:gcve-cvs-guest-031.png["该图显示输入/输出对话框或表示书面内容"]

. 选择适当的服务。对于 GCVE，根据工作负载要求选择NetApp Volumes-Performance 和所需的服务级别，以改善延迟并提高性能。
+
image:gcve-cvs-guest-032.png["该图显示输入/输出对话框或表示书面内容"]

. 指定卷和卷路径的 Google Cloud 区域（卷路径在项目的所有云卷中必须是唯一的）
+
image:gcve-cvs-guest-033.png["该图显示输入/输出对话框或表示书面内容"]

. 选择卷的性能级别。
+
image:gcve-cvs-guest-034.png["该图显示输入/输出对话框或表示书面内容"]

. 指定卷的大小和协议类型。本次测试中使用了 SMB。
+
image:gcve-cvs-guest-035.png["该图显示输入/输出对话框或表示书面内容"]

. 在此步骤中，选择可访问卷的 VPC 网络。确保 VPC 对等连接已到位。
+
提示：如果尚未完成 VPC 对等连接，则会显示一个弹出按钮来指导您完成对等连接命令。打开 Cloud Shell 会话并执行适当的命令以将您的 VPC 与Google Cloud NetApp Volumes生产者对等连接。如果您决定提前准备 VPC 对等连接，请参阅这些link:https://cloud.google.com/architecture/partners/netapp-cloud-volumes/setting-up-private-services-access?hl=en["指示"]。

+
image:gcve-cvs-guest-036.png["该图显示输入/输出对话框或表示书面内容"]

. 单击“保存”以创建卷。
+
image:gcve-cvs-guest-037.png["该图显示输入/输出对话框或表示书面内容"]



要安装 SMB 卷，请执行以下操作：

. 在 Cloud Console 中，转到 Cloud Volumes > Volumes。
. 转到卷页面
. 单击要映射 SMB 共享的 SMB 卷。
. 滚动到右侧，在“显示更多”下单击“安装说明”。


要从 VMware VM 的 Windows 客户操作系统中执行安装过程，请按照以下步骤操作：

. 单击“开始”按钮，然后单击“计算机”。
. 单击“映射网络驱动器”。
. 在驱动器列表中，单击任何可用的驱动器号。
. 在文件夹框中，键入：
+
 \\nimsmb-3830.nimgcveval.com\nimCVSMBvol01
+
image:gcve-cvs-guest-038.png["该图显示输入/输出对话框或表示书面内容"]

+
若要在每次登录计算机时进行连接，请选中“登录时重新连接”复选框。

. 单击“完成”。
+
image:gcve-cvs-guest-039.png["该图显示输入/输出对话框或表示书面内容"]



====