---
sidebar: sidebar 
permalink: openshift/os-op-setup.html 
keywords: NetApp Solutions, redhat OpenShift, red hat OpenShift, redhat openshift container platform, ocp, openshift container platform, Advanced Cluster Management, ACM, Hub Cluster, containers, container workloads, VMware, customer managed storage, ONTAP 
summary:  
---
= 在 VMware 上部署和配置 Red Hat OpenShift Container 平台
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
本节介绍了如何设置和管理 OpenShift 集群以及管理其上的有状态应用程序的高级工作流程。它展示了如何使用NetApp ONTAP存储阵列借助Trident来提供持久卷。


NOTE: 部署 Red Hat OpenShift Container 平台集群有多种方法。此设置的高级描述提供了所使用的特定方法的文档链接。您可以参考link:os-solutions-resources.html["资源部分"]。

下面是描述数据中心内 VMware 上部署的集群的图表。

image:rhhc-on-premises.png["该图显示输入/输出对话框或表示书面内容"]

设置过程可分为以下步骤：

.部署并配置 CentOS VM
[%collapsible%open]
====
* 它部署在VMware vSphere环境中。
* 该虚拟机用于为解决方案部署一些组件，例如NetApp Trident和NetApp Trident Protect。
* 安装期间，此虚拟机上配置了一个 root 用户。


====
.在 VMware vSphere（Hub Cluster）上部署和配置 OpenShift Container Platform 集群
[%collapsible%open]
====
请参阅link:https://docs.openshift.com/container-platform/4.17/installing/installing_vsphere/installing-vsphere-assisted-installer.html["协助部署"]部署 OCP 集群的方法。


TIP: 请记住以下内容： - 创建 ssh 公钥和私钥以提供给安装程序。如果需要，这些密钥将用于登录主节点和工作节点。 - 从辅助安装程序下载安装程序。该程序用于启动您在 VMware vSphere 环境中为主节点和工作节点创建的虚拟机。  - 虚拟机应具备最低 CPU、内存和硬盘要求。  （请参阅 vm create 命令link:https://docs.redhat.com/en/documentation/assisted_installer_for_openshift_container_platform/2024/html/installing_openshift_container_platform_with_the_assisted_installer/installing-on-vsphere["这"]提供此信息的主节点和工作节点的页面） - 应在所有虚拟机上启用 diskUUID。  - 为 master 创建至少 3 个节点，为 worker 创建至少 3 个节点。  - 一旦安装程序发现它们，请打开 VMware vSphere 集成切换按钮。

====
.在 Hub 集群上安装高级集群管理
[%collapsible%open]
====
这是使用 Hub 集群上的高级集群管理操作员安装的。参考说明link:https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.7/html/install/installing#doc-wrapper["此处"]。

====
.安装两个额外的 OCP 集群（源和目标）
[%collapsible%open]
====
* 可以使用 Hub 集群上的 ACM 部署附加集群。
* 参考说明link:https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.7/html/clusters/cluster_mce_overview#vsphere_prerequisites["此处"]。


====
.配置NetApp ONTAP存储
[%collapsible%open]
====
* 在 VMWare 环境中安装与 OCP VM 连接的ONTAP集群。
* 创建 SVM。
* 配置 NAS 数据生命周期以访问 SVM 中的存储。


====
.在 OCP 集群上安装NetApp Trident
[%collapsible%open]
====
* 在所有三个集群上安装NetApp Trident ：中心集群、源集群和目标集群
* 参考说明link:https://docs.netapp.com/us-en/trident/trident-get-started/kubernetes-deploy-operator.html["此处"]。
* 为 ontap-nas 创建存储后端。
* 为 ontap-nas 创建存储类。
* 参考说明link:https://docs.netapp.com/us-en/trident/trident-use/create-stor-class.html["此处"]。


====
.在源集群上部署应用程序
[%collapsible%open]
====
使用 OpenShift GitOps 部署应用程序。  （例如 Postgres、Ghost）

====
下一步是使用Trident Protect 进行数据保护和从源集群到目标集群的数据迁移。参考link:os-dp-tp-solution.html["此处"]以获取说明。
