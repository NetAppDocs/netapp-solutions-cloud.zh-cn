---
sidebar: sidebar 
permalink: openshift/os-pm-setup.html 
keywords: NetApp Solutions, redhat OpenShift, red hat OpenShift, redhat openshift container platform, ocp, openshift container platform, Advanced Cluster Management, ACM, Hub Cluster, containers, container workloads, VMware, customer managed storage, ONTAP, ROSA, ROSA clusters 
summary:  
---
= 在 AWS 上部署和配置托管 Red Hat OpenShift 容器平台
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
本节介绍在 AWS（ROSA）上设置托管 Red Hat OpenShift 集群的高级工作流程。它展示了Trident使用托管的Amazon FSx for NetApp ONTAP (FSx ONTAP ) 作为存储后端来提供持久卷。提供了有关使用BlueXP在 AWS 上部署 FSx ONTAP的详细信息。此外，还提供了有关使用BlueXP和 OpenShift GitOps（Argo CD）为 ROSA 集群上的有状态应用程序执行数据保护和迁移活动的详细信息。

下图描述了部署在 AWS 上并使用 FSx ONTAP作为后端存储的 ROSA 集群。

image:rhhc-rosa-with-fsxn.png["该图显示输入/输出对话框或表示书面内容"]


NOTE: 该解决方案通过在AWS的两个VPC中使用两个ROSA集群进行了验证。每个 ROSA 集群都使用Trident与 FSx ONTAP集成。在 AWS 中部署 ROSA 集群和 FSx ONTAP有几种方法。此设置的高级描述提供了所使用的特定方法的文档链接。您可以参考link:os-solutions-resources.html["资源部分"]。

设置过程可分为以下步骤：

.安装ROSA集群
* 创建两个 VPC 并在 VPC 之间建立 VPC 对等连接。
* 参考link:https://docs.openshift.com/rosa/welcome/index.html["此处"]有关安装 ROSA 集群的说明。


.安装 FSx ONTAP
* 从BlueXP在 VPC 上安装 FSx ONTAP 。参考link:https://docs.netapp.com/us-en/cloud-manager-setup-admin/index.html["此处"]用于创建BlueXP帐户并开始使用。参考link:https://docs.netapp.com/us-en/cloud-manager-fsx-ontap/index.html["此处"]用于安装 FSx ONTAP。参考link:https://docs.netapp.com/us-en/cloud-manager-setup-admin/index.html["此处"]用于在 AWS 中创建连接器来管理 FSx ONTAP。
* 使用 AWS 部署 FSx ONTAP 。参考link:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/getting-started-step1.html["此处"]使用 AWS 控制台进行部署。


.在 ROSA 集群上安装Trident （使用 Helm 图表）
* 使用 Helm chart 在 ROSA 集群上安装Trident 。请参阅文档链接： https://docs.netapp.com/us-en/trident/trident-get-started/kubernetes-deploy-helm.html [此处]。


.FSx ONTAP与Trident集成用于 ROSA 集群
video::621ae20d-7567-4bbf-809d-b01200fa7a68[panopto]

NOTE: OpenShift GitOps 可用于将Trident CSI 部署到所有托管集群，因为它们使用 ApplicationSet 注册到 ArgoCD。

image:rhhc-trident-helm.png["该图显示输入/输出对话框或表示书面内容"]

.使用Trident创建后端和存储类（适用于 FSx ONTAP）
* 参考link:https://docs.netapp.com/us-en/trident/trident-use/backends.html["此处"]有关创建后端和存储类的详细信息。
* 从 OpenShift 控制台将使用Trident CSI 为 FsxN 创建的存储类设为默认。请参阅下面的截图：


image:rhhc-default-storage-class.png["该图显示输入/输出对话框或表示书面内容"]

.使用 OpenShift GitOps（Argo CD）部署应用程序
* 在集群上安装 OpenShift GitOps 操作员。参考说明link:https://docs.openshift.com/container-platform/4.10/cicd/gitops/installing-openshift-gitops.html["此处"]。
* 为集群设置一个新的 Argo CD 实例。参考说明link:https://docs.openshift.com/container-platform/4.10/cicd/gitops/setting-up-argocd-instance.html["此处"]。


打开Argo CD的控制台并部署一个应用程序。例如，您可以使用带有 Helm Chart 的 Argo CD 部署 Jenkins 应用程序。创建应用程序时，提供了以下详细信息：项目：默认集群：'https://kubernetes.default.svc'[] （不带引号）命名空间：Jenkins Helm Chart 的 URL：'https://charts.bitnami.com/bitnami'[] （不带引号）

Helm 参数：global.storageClass: fsxn-nas
