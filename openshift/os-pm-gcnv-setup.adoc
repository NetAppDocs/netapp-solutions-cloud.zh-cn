---
sidebar: sidebar 
permalink: openshift/os-pm-gcnv-setup.html 
keywords: NetApp Solutions, Redhat OpenShift Dedicated, Red hat OpenShift, redhat openshift container platform, ocp, openshift container platform, Advanced Cluster Management, ACM, Hub Cluster, containers, container workloads, VMware, customer managed storage, ONTAP, Google Cloud, Google Cloud NetApp Volumes 
summary:  
---
= 使用Google Cloud NetApp Volumes在 Google Cloud 上部署和配置 OpenShift Dedicated
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
本节介绍在 Google Cloud 平台上设置 OpenShift Dedicated (OSD) 集群的高级工作流程。它显示NetApp Trident使用Google Cloud NetApp Volumes作为存储后端，为使用 Kubernetes 运行的有状态应用程序提供持久卷。

下图描述了部署在 Google Cloud 上并使用NetApp Volumes 作为后端存储的 OSD 集群。

image:rhhc-osd-with-gcnv.png["该图显示输入/输出对话框或表示书面内容"]

设置过程可分为以下步骤：

.在 Google Cloud 中安装 OSD 集群
* 如果您希望为集群使用现有的 VPC，则必须为 OSD 集群创建 VPC、两个子网、一个云路由器和两个 GCP 云 NAT。参考link:https://cloud.redhat.com/experts/gcp/osd_preexisting_vpc/["此处"]以获取说明。
* 参考link:https://docs.openshift.com/dedicated/osd_install_access_delete_cluster/creating-a-gcp-cluster.html#osd-create-gcp-cluster-ccs_osd-creating-a-cluster-on-gcp["此处"]有关使用客户云订阅 (CCS) 计费模型在 GCP 上安装 OSD 集群的说明。 OSD 也包含在 Google Cloud Marketplace 中。演示如何使用 Google Cloud Marketplace 解决方案安装 OSD 的视频位于link:https://www.youtube.com/watch?v=p9KBFvMDQJM["此处"]。


.启用Google Cloud NetApp Volumes
* 参考link:https://cloud.google.com/netapp/volumes/docs/get-started/configure-access/workflow["此处"]有关设置对Google Cloud NetApp Volumes 的访问权限的信息。遵循所有步骤，包括
* 创建存储池。参考link:https://cloud.google.com/netapp/volumes/docs/get-started/quickstarts/create-storage-pool#create_a_storage_pool["此处"]有关如何在Google Cloud NetApp Volumes上设置存储池的信息。将在存储池内创建在 OSD 上运行的有状态 Kubernetes 应用程序的卷。


.在 OSD 集群上安装Trident （使用 Helm 图表）
* 使用 Helm 图表在 OSD 集群上安装Trident 。参考link:https://docs.netapp.com/us-en/trident/trident-get-started/kubernetes-deploy-helm.html#critical-information-about-astra-trident-24-06["此处"]有关如何安装 Helm Chart 的说明。舵图可能位于link:https://github.com/NetApp/trident/tree/master/helm/trident-operator["此处"]。


.将NetApp Volumes 与NetApp Trident集成用于 OSD 集群
使用Trident创建后端和存储类（适用于Google Cloud NetApp Volumes）

* 有关创建后端的详细信息，请参阅此处。
* 如果 kubernetes 中的任何当前存储类被标记为默认，请通过编辑存储类来删除该注释。
* 使用Trident CSI 配置程序为NetApp卷创建至少一个存储类。使用注释将其中一个存储类设为默认存储类。当 PVC 清单中未明确调用时，这将允许 PVC 使用此存储类。下面显示了一个带有注释的示例。


[source]
----
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: gcnv-standard-k8s
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
provisioner: csi.trident.netapp.io
parameters:
  backendType: "google-cloud-netapp-volumes"
  trident.netapp.io/nasType: "nfs"
allowVolumeExpansion: true
----
.使用 OpenShift GitOps（Argo CD）部署应用程序
* 在集群上安装 OpenShift GitOps 操作员。参考说明link:https://docs.openshift.com/gitops/1.13/installing_gitops/installing-openshift-gitops.html["此处"]。
* 为集群设置一个新的 Argo CD 实例。参考说明link:https://docs.openshift.com/gitops/1.13/argocd_instance/setting-up-argocd-instance.html["此处"]。


打开Argo CD的控制台并部署一个应用程序。例如，您可以使用带有 Helm Chart 的 Argo CD 部署 Jenkins 应用程序。创建应用程序时，提供了以下详细信息：项目：默认集群：'https://kubernetes.default.svc'[] （不带引号）命名空间：Jenkins Helm Chart 的 URL：'https://charts.bitnami.com/bitnami'[] （不带引号）
